<!DOCTYPE html>
<html>
    <head>
        <title>{{ title }}</title>
        <link rel="stylesheet" href="static/css/style.css">
    </head>
    <body>
        <div style="width: 100%; height: 40px" id="username"></div>
        <div style="width:50%; padding: 20px; overflow-y: scroll;">
            <div id="messages"></div>
            <div style="padding-top: 20px;">
                <form onsubmit="return sendMessage()">
                    <input id="message" type="text" style="width: 70%;"><button style="width: 25%">Send</button>
                </form>
            </div>
        </div>
        <p>Musik:</p>
        {% for card in musik %}
            <img src="{{ card.display() }}" alt="Zdjęcie karty {{ card.display() }}" width="100px"/>
        {% end %}
        <p>Reszta kart:</p>
        {% for card in cards %}
            <img src="{{ card.display() }}" alt="Zdjęcie karty {{ card.display() }}" width="100px"/>
        {% end %}
        <script>
        var ws = new WebSocket("ws://localhost:8888/websocket");
        var username = prompt("What's your name?");

        if (username){
            sendPacket(setPayload("Connected", username, Date()));
            var usernameBox = document.getElementById("username");
            usernameBox.innerHTML = "USERNAME: " + username;
        }

        function setPayload(message, user, time) {
            return {"message": message,
                    "user" : user,
                    "time" : time}
        }

        function sendPacket(payload) {
            ws.send(JSON.stringify(payload))
        }

        function sendMessage() {
            var messageInput = document.getElementById("message");
            var message = messageInput.value;
            var payload = {
                "message": message,
                "user": username
            };
            // Make the request to the WebSocket.
            ws.send(JSON.stringify(payload));
            // Clear the message from the input.
            messageInput.value = "";
            return false;
        }

        ws.onmessage = function(evt) {
            console.log(evt);
            var messageDict = JSON.parse(evt.data);
            // Create a div with the format `user: message`.
            var messageBox = document.createElement("div");
            messageBox.innerHTML = messageDict.time + messageDict.user + ": " + messageDict.message;
            document.getElementById("messages").appendChild(messageBox);
        };
        </script>
    </body>
</html>